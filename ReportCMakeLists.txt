cmake_minimum_required(VERSION ${CMAKE_VERSION})
project(CentralBuilderReport C CXX)

if(CB_ENV_REPORT_FILE)
  file(APPEND "${CB_ENV_REPORT_FILE}"
    "HOST_SYSTEM: ${CMAKE_HOST_SYSTEM}\n"
    "HOST_SYSTEM_PROCESSOR: ${CMAKE_HOST_SYSTEM_PROCESSOR}\n")
  set(CB_ENV_REPORT_FILE "" CACHE INTERNAL "" FORCE)
endif()

if(CB_FIND_PACKAGE_REPORT_FILE)
  file(WRITE "${CB_FIND_PACKAGE_REPORT_FILE}" "")
  foreach(name ${PKG_NAMES})
    find_package(${name} QUIET CONFIG)
    string(TOUPPER "${name}" NAME)
    if(${name}_FOUND OR ${NAME}_FOUND)
      file(APPEND "${CB_FIND_PACKAGE_REPORT_FILE}" "${name}: FOUND config-module in ${${name}_DIR}\n")
    else()
      if(${name}_DIR)
        file(APPEND "${CB_FIND_PACKAGE_REPORT_FILE}" "${name}: NOT FOUND (config-module found in ${${name}_DIR})\n")
      else()
        file(APPEND "${CB_FIND_PACKAGE_REPORT_FILE}" "${name}: NOT FOUND (no config-module)\n")
      endif()
      find_package(${name} QUIET MODULE)
      if(${name}_FOUND OR ${NAME}_FOUND)
        file(APPEND "${CB_FIND_PACKAGE_REPORT_FILE}" "    - but can be found with find-module\n")
      endif()
    endif()
  endforeach()
  set(CB_FIND_PACKAGE_REPORT_FILE "" CACHE INTERNAL "" FORCE)
endif()
